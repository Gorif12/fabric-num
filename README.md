# 基于 Hyperledger Fabric 的房地产交易系统

本项目是一个基于 Hyperledger Fabric 区块链的房地产交易系统，实现了房产信息上链和房产交易的全流程。

## 系统架构

系统采用双层架构设计：

1. 应用层（后端服务）
    - 提供 RESTful API 接口
    - 实现用户认证和权限控制
    - 与区块链网络交互

2. 区块链层（Fabric 网络）
    - 维护房产信息和交易数据
    - 执行智能合约
    - 实现组织级别的权限控制

## 权限控制机制

系统实现了双重权限控制机制，确保交易的安全性和可信度：

### 1. 应用层权限控制

通过用户角色进行权限管理：

- `USER`：普通用户
    - 可以查询房产信息
    - 可以作为买家购买房产
    - 可以作为卖家出售房产

- `REALTY_ADMIN`：房管局管理员
    - 负责房产信息的创建和管理

- `BANK_ADMIN`：银行管理员
    - 负责确认资金托管
    - 负责完成交易

### 2. 区块链层权限控制

通过组织身份（MSP）进行权限管理：

- `Org1MSP`：房管局组织
    - 只有房管局组织的成员才能创建房产信息
    - 确保房产信息的权威性

- `Org2MSP`：银行组织
    - 只有银行组织的成员才能确认资金托管
    - 只有银行组织的成员才能完成交易
    - 确保交易资金安全

### 权限控制流程示例

以创建房产信息为例：

1. 用户（房管局管理员）通过 API 发起创建房产请求
2. 后端服务验证用户身份是否为 `REALTY_ADMIN`
3. 使用房管局组织的身份证书调用智能合约
4. 智能合约验证调用者身份是否为 `Org1MSP`
5. 只有双重验证都通过才能创建房产信息

## 业务流程

1. 房产信息上链
    - 房管局管理员创建房产信息
    - 信息包括：房产ID、地址、面积、所有者、价格等

2. 房产交易流程
    - 创建交易：买家发起购买请求
    - 资金托管：银行确认买家资金托管
    - 完成交易：银行确认交易完成，更新房产所有权

## 技术特点

1. 完整的权限控制
    - 应用层：基于用户角色的访问控制
    - 区块链层：基于组织身份的权限控制
    - 双重验证确保系统安全

2. 数据隐私保护
    - 用户信息存储在传统数据库中
    - 关键交易数据存储在区块链上
    - 合理划分数据存储位置

3. 可追溯性
    - 所有房产交易记录永久保存在区块链上
    - 支持交易历史查询
    - 确保交易信息不可篡改

## 部署说明

1. 启动 Fabric 网络，部署智能合约
   ```bash
   cd network
   ./install.sh
   ```

2. 启动后端服务
   ```bash
   cd application/server
   go run main.go
   ```

## API 文档

### 用户相关接口

1. 用户注册
   ```
   POST /api/user/register
   ```

2. 用户登录
   ```
   POST /api/user/login
   ```

### 房产相关接口

1. 创建房产信息（房管局管理员）
   ```
   POST /api/realty/admin/create
   ```

2. 查询房产信息
   ```
   GET /api/realty/:id
   ```

3. 创建交易
   ```
   POST /api/realty/transaction
   ```

4. 确认资金托管（银行管理员）
   ```
   POST /api/realty/bank/escrow/:txId
   ```

5. 完成交易（银行管理员）
   ```
   POST /api/realty/bank/complete/:txId
   ```
